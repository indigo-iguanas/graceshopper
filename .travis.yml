language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "emotionsrus-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)

before_deploy:
  - npm run build-client # make the bundle
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: 'emotionsrus'
  api_key:
    secure: iL7+Pe8JsG0hsi+dW89eDlxahJZZAk9R/jgE4gNzDR203W12LBeygQR++uRXRbtDCehUuDR+xkMM
    # secure: Db67PeEiixtGY5MoGWJ9P97SKIx3mQqgNiDR/2u6MTwAEjJAshYc9W8NBNAOSkpJLZXFwDY+jEk2
    # secure: q0xa+o8XOZzXhcUlMJ+vNHPHE/tHGU6a3t7q7Hc26LUf5rKdnrf5LDg0ioUZy9zfuGfYIwdGbWdn
    # secure: 8krC0yxcM5LcmMQrdnkNZS+EYIfTURi/TfwgIbkgzgnrk8F5yKExKjWadndRSM4qbeMozaNjJbyK
    # secure: lGW+uH4+t3oLSpzsYUc5nx2DNZEidzo/+ciHiVgnlvYWAaz2p8tHG9hd/V9En6Fyt7SaJKCcbA/N
    # secure: kcVcWPNfdJA+rf55wPmXezMxoQDaYqsNnLX0wLo0p0eUSpKdvizYq4FMDsT7iQCHUfndwDBmZwND
    # secure: xOlqwIHj9ILD1biPZvHpFQrGl0bPlRMt2H4N/J2GSKorwuziV2S1ZJL0mQjPh1XSXwxa2zcTZahq
    # secure: sofIT8ofbezjXO53w6CcPMkTD6GTZoiiWnONhmoRE8pM69moOVNcEi75bCfV3SXp/A5YbMJcvGyw
    # secure: FZYgSnLoR4s+GK/9dqj1ew93/4Yfu4aZSTnzF8N2QwaJxtXdlmBfmrwSYj0JKsh4QvcOzHlOvIc=
